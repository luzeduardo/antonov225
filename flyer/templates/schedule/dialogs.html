{% load flyerapp_tags %}

<!-- MODAL EDICAO - Begin -->
<script type="text/javascript">
    function leftValue( value, handle, slider ) {
        $(this).text( handle.parent()[0].style.left );
    }

    function hleftValue( value, handle, slider ) {
        var tmpvalue = value.replace(/\D+/g, '' )/10000;
        var current = $("#current-sch-price-{{ schedule.id }}").val();
        var pctvalue = (parseInt(current) * tmpvalue) + parseInt(current);
        $(this).val( pctvalue );
        $(this).text( pctvalue );
    }

    function lleftValue( value, handle, slider ) {
        var tmpvalue = value.replace(/\D+/g, '' )/10000;
        var current = $("#current-sch-price-{{ schedule.id }}").val();
        var pctvalue =  parseInt(current) - (parseInt(current) * tmpvalue);
        $(this).val( pctvalue );
        $(this).text( pctvalue );
    }

    function priceConvert( value, handle, slider ) {
        var tmpvalue = value.replace(/\D+/g, '' );
        tmpvalue = (tmpvalue/10000) + 1;
        $(this).val( tmpvalue );
        $(this).text( tmpvalue );
    }

    $(document).ready(function () {
        //range pesquisa
        var elidlower = "#slider-price-lower-sch-{{ schedule.id }}";
        var elidhighter = "#slider-price-highter-sch-{{ schedule.id }}";

        var tmplvalue = "{{ schedule.price_percent_lower }}";
        tmplvalue = tmplvalue - 1;
        tmplvalue = parseInt(tmplvalue * 100);

        var tmphvalue = "{{ schedule.price_percent_highter }}";
        tmphvalue = tmphvalue - 1;
        tmphvalue = parseInt(tmphvalue * 100);

        $(elidlower).noUiSlider({
            start: tmplvalue,
            step: 10,
            range: {
                'min': 1,
                '10%': 10,
                '20%': 20,
                '30%': 30,
                '40%': 40,
                '50%': 50,
                '60%': 60,
                '70%': 70,
                '80%': 80,
                '90%': 90,
                'max': 100
            }
        });
        $(elidlower).Link('lower').to($("#current-sch-price-lower-{{ schedule.id }}"),leftValue);
        $(elidlower).Link('lower').to($("#current-price-lower-{{ schedule.id }}"),lleftValue);

        console.log(tmplvalue);
        console.log(tmphvalue);
        $(elidhighter).noUiSlider({
            start: tmphvalue,
            step: 10,
            range: {
                'min': 1,
                '10%': 10,
                '20%': 20,
                '30%': 30,
                '40%': 40,
                '50%': 50,
                '60%': 60,
                '70%': 70,
                '80%': 80,
                '90%': 90,
                'max': 100
            }
        });
        $(elidhighter).Link('lower').to($("#current-sch-price-highter-{{ schedule.id }}"),leftValue);
        $(elidhighter).Link('lower').to($("#current-price-highter-{{ schedule.id }}"),hleftValue);

{#        $(elidhighter).Link('lower').to($("#hprice-{{ schedule.id }}"), priceConvert);#}
{#        $(elidlower).Link('lower').to($("#lprice-{{ schedule.id }}"), priceConvert);#}
{##}
{#        $(elidlower).Link('lower').to($("#lower-value-{{ schedule.id }}"));#}
{#        $(elidlower).Link('lower').to($("#lower-offset-{{ schedule.id }}"), lleftValue);#}

{#        $(elidhighter).Link('lower').to($("#upper-value-{{ schedule.id }}"));#}
{#        $(elidhighter).Link('lower').to($("#upper-offset-{{ schedule.id }}"), hleftValue);#}


        //preco atual
        var atualpriceelid = "#slider-atual-price-sch-{{ schedule.id }}";
        $(atualpriceelid).noUiSlider({
            start: "{{ schedule.price }}",
            step: 50,
            range: {
                'min': 200,
                'max': 5000
            }
        });
        $(atualpriceelid).Link('lower').to($("#current-sch-price-{{ schedule.id }}"));
        $(atualpriceelid).Link('lower').to($("#current-price-{{ schedule.id }}"));

        $("#dt-start-{{ schedule.id }}").datetimepicker({
            format: 'DD/MM/YYYY',
            defaultDate: "{{ schedule.departure_date|convertdateformat:"%Y-%m-%d" }}",
            locale: 'pt-br',
            allowInputToggle: true
        });

        $("#dt-end-{{ schedule.id }}").datetimepicker({
            format: 'DD/MM/YYYY',
            defaultDate: "{{ schedule.landing_date|convertdateformat:"%Y-%m-%d" }}",
            locale: 'pt-br',
            allowInputToggle: true
        });
    });
</script>

<div class="modal" id="modal-schedule-edit-{{ schedule.id }}" tabindex="-1" role="dialog" aria-labelledby="schEdit"
     aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <button type="button" class="close" data-dismiss="modal"><span aria-hidden="true">&times;</span><span
                        class="sr-only">Fechar</span></button>
                <h4 class="modal-title">Editar Pesquisa</h4>
            </div>
            <div class="modal-body">
                <form method="POST" role="form" id="frm_sch_edit">
                    <fieldset>
                        <input type="hidden" value="{{ schedule.id }}">


                            <div class="col-md-6">
                                <div class="form-group">
                                    <label class="control-label" for="sch-price">Decolagem</label>
                                    <div class='input-group date' id='dt-start-{{ schedule.id }}'>
                                        <input type='text' class="form-control" />
                                        <span class="input-group-addon">
                                            <span class="glyphicon glyphicon-calendar"></span>
                                        </span>
                                    </div>
                                </div>
                            </div>
                            <div class="col-md-6">
                                <div class="form-group">
                                    <label class="control-label" for="sch-price">Pouso</label>
                                    <div class='input-group date' id='dt-end-{{ schedule.id }}'>
                                        <input type='text' class="form-control" />
                                        <span class="input-group-addon">
                                            <span class="glyphicon glyphicon-calendar"></span>
                                        </span>
                                    </div>
                                </div>
                            </div>
{#                            <label class="control-label" for="sch-price">Pouso</label>#}
{#                            <div class='input-group date' id='dt-start-{{ schedule.id }}'>#}
{#                                <input type='text' class="form-control" />#}
{#                                <span class="input-group-addon">#}
{#                                    <span class="glyphicon glyphicon-calendar"></span>#}
{#                                </span>#}
{#                            </div>#}

                        <div class="col-md-6">

                            <div class="form-group">
                                <label class="control-label" for="sch-price">Preço de busca: <b><span id="current-price-{{ schedule.id }}"></span></b></label>
                                <div id="slider-atual-price-sch-{{ schedule.id }}"></div>

                                <input type="hidden" name="sch-price" id="current-sch-price-{{ schedule.id }}">
                            </div>

                            <div class="form-group">
                                <label class="control-label" for="sch-price">Preço mínimo: <b><span id="current-price-lower-{{ schedule.id }}"></span></b></label>
                                <div id="slider-price-lower-sch-{{ schedule.id }}"></div>

                                <input type="hidden" name="sch-price-lower" id="current-sch-price-lower-{{ schedule.id }}">
                            </div>

                            <div class="form-group">
                                <label class="control-label" for="sch-price">Preço máximo: <b><span id="current-price-highter-{{ schedule.id }}"></span></b></label>
                                <div id="slider-price-highter-sch-{{ schedule.id }}"></div>

                                <input type="hidden" name="sch-price-highter" id="current-sch-price-highter-{{ schedule.id }}">
                            </div>
{##}
{#                            <div class="form-group">#}
{#                                <p>Mínimo: <span id="lower-offset-{{ schedule.id }}"></span></p>#}
{#                                <p>Máximo: <span id="upper-offset-{{ schedule.id }}"></span></p>#}
{#                                <input type="hidden" name="lprice" id="lprice-{{ schedule.id }}">#}
{#                                <input type="hidden" name="hprice" id="hprice-{{ schedule.id }}">#}
{#                            </div>#}
                        </div>


                    </fieldset>
                </form>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-default" data-dismiss="modal">Cancelar</button>
                <button type="button" class="btn btn-primary" id="bt-sch-edit-sim">Salvar</button>
            </div>
        </div>

    </div>
</div>
<!-- MODAL EDICAO- End -->